@using Engnest.Entities.Common;
@{
	Engnest.Entities.ViewModels.ProfileModel Model = ViewBag.ProfileModel;
}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>@ViewBag.Title - My ASP.NET Application</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
	@Styles.Render("~/css/css")
	@Scripts.Render("~/bundles/jquery")
	@Scripts.Render("~/bundles/bootstrap")
	@Scripts.Render("~/bundles/js")
	<script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
	<!--Reference the autogenerated SignalR hub script. -->
	<script src="~/signalr/hubs"></script>
	<!--SignalR script to update the chat page and send messages.-->
</head>
<body>
	<header class="header-container">
		<div class="navbar navbar-default navbar-fixed-top">
			<nav class="header-fixed1000">
				<div class="container-fluid">
					<a class="brand header-brand" href="/">
						<img width="75" height="30" src="/assets/images/logoEngnest.jpg" alt="Mạng Xã Hội Việt Nam Logo">
					</a>
					<ul class="nav navbar-nav left_part_header">
						<li class="head_name_links">
							<a class="sixteen-font-size homelink_count" href="/profile" data-ajax="?index.php?link1=home">
								<i class="fa fa-home" aria-hidden="true" style="font-size:19px"></i>
								<span>Timeline</span>
							</a>
						</li>
						@*<li class="head_name_links">
								<form class="navbar-form form-group" data-toggle="dropdown" role="button" id="navbar-searchbox">
									<div class="form-group inner-addon left-addon ">
										<i class="fa fa-search"></i>
										<input type="text" class="form-control search-input" onkeyup="Wo_DetectSearchType(this.value), document.getElementById('wo_repeat_search').innerHTML = escapeHtml(this.value)" placeholder="Tìm ai đó, trang" dir="auto" onfocus="Wo_GetRecentSearchs()">
									</div>
								</form>
							</li>*@
						<li class="search-container">
							<div class="dropdown head_srch_drop">
								<div class="head_clos_srch" id="close_header_search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg></div>
								<form class="navbar-form form-group" data-toggle="dropdown" role="button" id="navbar-searchbox">
									<div class="form-group inner-addon left-addon ">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search glyphicon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
										<input type="text" class="form-control search-input" onkeyup="Wo_DetectSearchType(this.value), document.getElementById('wo_repeat_search').innerHTML = escapeHtml(this.value)" placeholder="Tìm ai đó, trang, chapter hay #gắnthẻ" dir="auto" onfocus="Wo_GetRecentSearchs()">
									</div>
								</form>
								<ul class="dropdown-menu search-dropdown-container" style="margin-left:7px;" role="menu">
									<div class="search-dropdown-result">
									</div>
									<li>
										<span class="search-advanced-container">
											<a href="/search" class="search-advanced-link" data-ajax="?link1=search">
												<div class="feather-svg-parent">
													<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
												</div>
												<span style="vertical-align: middle;display: table-cell;padding-left: 10px;">
													Tìm nâng cao
													<span id="wo_repeat_search"></span>
												</span>
											</a>
										</span>
									</li>
								</ul>
							</div>
						</li>
					</ul>


					<ul class="nav navbar-nav navbar-right pull-right" id="head_menu_rght">
						<li class="dropdown requests-container" onclick="Wo_OpenRequestsMenu();">
							<span id="alert-request" class="new-update-alert"></span>
							<a href="#" class="dropdown-toggle unread-update sixteen-font-size" data-toggle="dropdown" role="button" aria-expanded="false">
								<i class="fa fa-users" aria-hidden="true"></i>
							</a>
							<ul class="dropdown-menu request-list clearfix notifications-dropdown" role="menu" id="requests-list">
								<li>
									<h5 class="text-center">Không có lời mời nào</h5>
								</li>
							</ul>
						</li>
						<li class="dropdown messages-notification-container" onclick="Wo_OpenMessagesMenu();">
							<span class="new-update-alert hidden" style="display: none;">
								0
							</span>
							<a href="#" class="dropdown-toggle sixteen-font-size" data-toggle="dropdown" role="button" aria-expanded="false">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2Z"></path></svg>
							</a>
							<ul class="dropdown-menu clearfix notifications-dropdown messages-dropdown" role="menu" id="messages-list">
								<li>
									<h5 class="text-center"><svg width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><circle cx="50" cy="50" r="40" stroke="#676d76" fill="none" stroke-width="6" stroke-linecap="round"><animate attributeName="stroke-dashoffset" dur="1.5s" repeatCount="indefinite" from="0" to="502"></animate><animate attributeName="stroke-dasharray" dur="1.5s" repeatCount="indefinite" values="150.6 100.4;1 250;150.6 100.4"></animate></circle></svg></h5>
								</li>
							</ul>
						</li>
						<li class="dropdown notification-container" onclick="Wo_OpenNotificationsMenu();">
							<span class="new-update-alert hidden" style="display: none;">
								0
							</span>
							<a href="#" class="dropdown-toggle sixteen-font-size" data-toggle="dropdown" role="button" aria-expanded="false">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21"></path></svg>
							</a>
							<ul class="dropdown-menu clearfix notifications-dropdown" role="menu">
								<li onclick="Wo_TurnOffSound();" class="turn-off-sound text-left">
									<span>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg> Tắt âm thanh thông báo
									</span>
								</li>
								<li id="notification-list">
									<h5 class="text-center"><svg width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><circle cx="50" cy="50" r="40" stroke="#676d76" fill="none" stroke-width="6" stroke-linecap="round"><animate attributeName="stroke-dashoffset" dur="1.5s" repeatCount="indefinite" from="0" to="502"></animate><animate attributeName="stroke-dasharray" dur="1.5s" repeatCount="indefinite" values="150.6 100.4;1 250;150.6 100.4"></animate></circle></svg></h5>
								</li>
							</ul>
						</li>
						<li class="dropdown sun_bd_hd_scrl_menu">
							<a href="#" class="dropdown-toggle user-menu-combination" data-toggle="dropdown" role="button" aria-expanded="false">
								<span id="user-full-name" class="User-Name hidden-xs">
									Onl
								</span>
								<div class="user-avatar">
									<img id="updateImage-1961" src="@Model.Avatar" alt="@Model.NickName Picture">
								</div>
								<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="mobi_menu_hd"><path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"></path></svg>
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
							</a>
							<ul class="dropdown-menu ani-acc-menu" role="menu">
								<li>
									<a class="menu_firs_link" id="update-username" href="/profile?id=@Model.ID" data-ajax="?link1=timeline&amp;u=0dc53e223"><b>Onl Hero</b></a>
								</li>
								<li><hr></li>
								<li class="dropdown-hidden-link">
									<a href="/Profile/GeneralSetting" data-ajax="?link1=setting&amp;page=profile-setting">Sửa</a>
								</li>
								<li class="dropdown-hidden-link">
									<a onclick="PopupCreatedGroup()">Created Group</a>
								</li>
								<li>@Html.ActionLink("Đăng xuất", "SignOut", "Login")</li>
							</ul>
						</li>
					</ul>
				</div>
			</nav>
		</div>

		<div class="loader" style="display: none;"></div>


	</header>
	<div class="container body-content">
		@RenderBody()
	</div>
	<div class="extra">
		<div class="chat-all-container">
			<div class="chat-tab"></div>
			<div class="chat-container full" style="">
				<div class="online-toggle pointer" onclick="Wo_OpenChatUsersTab();">
					Chat
				</div>
				<div class="chat-status">
					<span class="pointer" style="margin-right: 5px;" onclick="Wo_CreateGChat(event)">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M13,13C11,13 7,14 7,16V18H19V16C19,14 15,13 13,13M19.62,13.16C20.45,13.88 21,14.82 21,16V18H24V16C24,14.46 21.63,13.5 19.62,13.16M13,11A3,3 0 0,0 16,8A3,3 0 0,0 13,5A3,3 0 0,0 10,8A3,3 0 0,0 13,11M18,11A3,3 0 0,0 21,8A3,3 0 0,0 18,5C17.68,5 17.37,5.05 17.08,5.14C17.65,5.95 18,6.94 18,8C18,9.06 17.65,10.04 17.08,10.85C17.37,10.95 17.68,11 18,11M8,10H5V7H3V10H0V12H3V15H5V12H8V10Z"></path></svg>
					</span>
					<div class="dropdown" style="display: inline;">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
						<ul class="dropdown-menu dropdown-menu-right" role="menu" style="min-width: 80px; font-size: 12px;">
							<li><a href="#" onclick="Wo_UpdateStatus('online',event);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> Online</a></li>
							<li><a href="#" onclick="Wo_UpdateStatus('offline',event);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye-off"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg> Offline</a></li>
						</ul>
					</div>
				</div>

				@*<div class="search">
						<input type="text" class="form-control search-users-chat" placeholder="Tìm một ai đó" onkeyup="Wo_ChatSearchUsers(this.value);">
					</div>*@

				<div class="online-content-toggler" style="display:block">
					<div class="chat-opacity ">
						<div class="text-center">
							<h5 class="empty_state">
								<span>
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye-off"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
									Bạn đang offline
								</span>
							</h5>
						</div>
					</div>

					<ul class="nav nav-tabs wo_chat_tabs">
						<li class="active">
							<a data-toggle="tab" data-target="#users-chat" href="#" data-placement="bottom" title="Thành viên">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"></path></svg>
								<span class="count-online-users">0</span>
							</a>
						</li>
					</ul>
					<div class="tab-content">
						<div id="users-chat" class="tab-pane fade in active">
							<div class="online-users"></div>
							<div class="offline-users">

								<div class="clear"></div>
							</div>
							<div class="clear"></div>
						</div>
						<div id="groups-chat" class="tab-pane fade groups chat_groups">
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade sun_modal" id="edit_group_chat" role="dialog">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<form id="edit_chat_group_form" class="wo_edit_chat_group">
						<div class="modal-body">
							<div class="edit_grp_info_modal">
								<div class="group_chat_avatar__container" onclick="$('#edit_group_chat_avatar_').trigger('click');">
									<span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"></path></svg></span>
								</div>
								<input type="text" class="form-control" name="group_name" placeholder="Tiêu đề" id="edit_group_name">
								<div class="clear"></div>
							</div>
							<div id="edit_chat_group_alert"></div>
						</div>
						<div class="modal-footer">
							<div class="ball-pulse"><div></div><div></div><div></div></div>
							<button id="delete-all-post" type="submit" class="btn btn-main">Cập nhật</button>
						</div>
						<input type="hidden" id="edit_group_id" class="hidden" name="group_id">
						<input type="file" name="avatar" class="hidden" id="edit_group_chat_avatar_" onchange="change_avatar(this);" accept="image/jpeg,image/png,image/gif">
					</form>
				</div>
			</div>
		</div>

		<div class="modal fade sun_modal" id="logged-out-modal" role="dialog" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title"><i class="fa fa-exclamation-circle"></i> Session Expired</h4>
					</div>
					<div class="modal-body">
						<p>Your Session has been expired, please login again.</p>
					</div>
					<div class="modal-footer">
						<a href="/login" type="button" class="btn btn-default">Đăng nhập</a>
					</div>
				</div>
			</div>
		</div>

		<div id="focus-overlay"></div>
	</div>
	<div class="container-fluid-md notifications">
		<div class="ajax-notification has-errors">
			<span class="ajax-notification-message"></span>
			<a class="close-notification" onclick="EngnestFlash.hide()"><i class="fa fa-times"></i></a>
		</div>
	</div>
	<script id="friend-template" type="x-tmpl-mustache">
		<div class="recipient-chat-user" id="online_{{Id}}">
			<div class="user-info" onclick="OpenChatTab('{{Id}}')">
				<div class="pull-right" style="margin-top:8px;">

					<svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24"><path fill="#CDCDCD" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"></path></svg>
					<span class="chat-loading-icon"></span>
				</div>
				<span class="chat-user-text" id="chat-tab-id">
					<div class="avatar pull-left">
						<span class="new-message-alert hidden">0</span>
						<img src="{{Avatar}}" alt="{{NickName}} Profile Picture">
					</div>
					<span class="wo_cen_onuser">{{NickName}}</span>
				</span>
			</div>
		</div>
	</script>
	<script id="chat-template" type="x-tmpl-mustache">
		<div class="chat_main chat_main_{{Id}}">
			<style>
				.chat-container {
					z-index: 8;
				}
			</style>
			<div class="chat-wrapper chat_4" id="chat_4">
				<div style="background:" class="online-toggle">
					<div class="cht_tg_left_prt" onclick="javascript:$('.chat-tab-container-4').slideToggle(100);">
						<a style="color:#fff;" target="_blank" href="/profile?id={{Id}}" data-ajax="?link1=timeline&amp;u=xinchao">
							<span class="chat-tab-status ">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"></path></svg>
							</span>
							{{NickNameTarget}}
						</a>
					</div>

					<img class="cht_hd_avtr" src="{{AvataTarget}}" alt="Xin Chào">

					<div class="cht_tg_right_prt">
						<span class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"></path></svg>
							</a>
							<ul class="dropdown-menu dropdown-menu-right clearfix" role="menu">
								<li class="dropdown-submenu chat_dd_sub_4">
									<a href="javascript:void(0);" class="change_color dropdown-toggle" data-toggle="dropdown" aria-expanded="true" role="button">
										<i class="fa fa-circle select-color" aria-hidden="true" style="color: "></i> Change color
									</a>
								</li>
							</ul>
						</span>
						<svg class="pointer" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" onclick="CloseChat({{Id}});"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg>
					</div>
				</div>

				<div class="chat-tab-container chat-tab-container-4 chat-tab-box-4">
					<div class="chat-messages-wrapper chat-messages-wrapper-4">
						<div class="chat-messages">
						</div>
						<div class="clear"></div>
					</div>
					<div class="chat-textarea btn-group">
						<form action="#" method="post" class="chat-sending-form-4">
							<div class="loading_cont">
								<div class="loading hidden"></div>
							</div>
							<div class="sun_chat_bottom">
								<textarea name="textSendMessage" id="sendMessage" class="form-control" cols="10" rows="5" placeholder="Write Something .." onkeyup="CreatedMessage(this, '{{Id}}');" dir="auto"></textarea>
								<div class="dropup chat_optns">
									<span class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
										<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12,17.5C14.33,17.5 16.3,16.04 17.11,14H6.89C7.69,16.04 9.67,17.5 12,17.5M8.5,11A1.5,1.5 0 0,0 10,9.5A1.5,1.5 0 0,0 8.5,8A1.5,1.5 0 0,0 7,9.5A1.5,1.5 0 0,0 8.5,11M15.5,11A1.5,1.5 0 0,0 17,9.5A1.5,1.5 0 0,0 15.5,8A1.5,1.5 0 0,0 14,9.5A1.5,1.5 0 0,0 15.5,11M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" fill="currentColor"></path></svg>
									</span>
								</div>
								<div class="dropup chat_optns">
									<span class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
										<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="currentColor"></path></svg>
									</span>
									<ul class="dropdown-menu dropdown-menu-right sun_chat_dopts_menu sun_cht_dd_menu_4" role="menu">
										<li>
											<a href="javascript:void(0);" class="btn btn-file" id="progressIcon">
												<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#6bcfef" d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"></path></svg>
												<p>Files</p>
												<input type="file" id="sendMessasgeFile" name="sendMessageFile" class="pointer" onchange="Wo_ShareChatFile(4);">
											</a>
										</li>
										<li class="dropdown-submenu sun_cht_dd_menu_sub_4" id="chat-gifs">
											<a href="javascript:void(0);" class="btn btn-file dropdown-toggle" data-toggle="dropdown" aria-expanded="true" role="button">
												<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24" viewBox="0 0 24 24" fill="#9d87d2"><path d="M15.5,2C18,2 20,4 20,6.5C20,7.38 19.75,8.21 19.31,8.9L22.39,12L21,13.39L17.88,10.32C17.19,10.75 16.37,11 15.5,11C13,11 11,9 11,6.5C11,4 13,2 15.5,2M15.5,4A2.5,2.5 0 0,0 13,6.5A2.5,2.5 0 0,0 15.5,9A2.5,2.5 0 0,0 18,6.5A2.5,2.5 0 0,0 15.5,4M7.5,14.5L4,19H18L13.5,13L10,17.5L7.5,14.5M20,20A2,2 0 0,1 18,22H4A2,2 0 0,1 2,20V6A2,2 0 0,1 4,4H9.5C9.18,4.77 9,5.61 9,6.5A6.5,6.5 0 0,0 15.5,13C16.18,13 16.84,12.89 17.46,12.7L20,15.24V20Z"></path></svg>
												<p>GIF</p>
											</a>
											<ul class="dropdown-menu drop-up" role="menu" onclick="event.stopPropagation()">
												<li>
													<div class="w100" id="chat-box-stickers">
														<input type="text" class="form-control" placeholder="Search GIFs" onkeyup="Wo_GetChatStickers(this)" data-user-id="4">
														<div id="chat-box-stickers-cont-4" class="chat-box-stickers-cont"></div>
													</div>
												</li>
											</ul>
										</li>
									</ul>
								</div>
							</div>
							<div class="w-10 chat-btns-w">
								<span data-chat-rtime="4" class="record_timei hidden">00:00</span>
							</div>
							<input type="hidden" id="user-id" class="chat-user-id" name="user_id" value="4">
							<input type="hidden" id="color" value="">
							<input type="hidden" name="message-record" class="message-record">
							<input type="hidden" name="media-name" class="media-name">
							<input type="hidden" name="chatSticker" id="chatSticker_4">
						</form>
					</div>
				</div>
			</div>
		</div>

	</script>
	<script id="reply-comment-template" type="x-tmpl-mustache">
		<div class="reply reply-container" id="comment_reply_{{Id}}" data-reply-id="{{Id}}">
			<a class="pull-left" href="/profile?id={{UserId}}" onclick="InjectAPI('{&quot;profile_id&quot; : &quot;1961&quot;, &quot;type&quot;:&quot;user&quot;}', event);">
				<img class="avatar pull-left" src="{{Avatar}}" alt="avatar">
			</a>
			<div class="comment-body">
				<div class="pull-right comment-options comment_edele_options">
					<span class="pointer" onclick="Wo_EditReplyComment({{Id}});">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon></svg>
					</span>
					&nbsp;
					<span class="pointer" id="deleteComment" onclick="Wo_DeleteReplyComment({{Id}});">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
					</span>
				</div>
				<div class="comment-heading reply-heading">
					<div class="sun_innr_comm">
						<span class="user-popover" data-id="1961" data-type="user">
							<a href="/profile?id={{UserId}}" data-ajax="?link1=timeline&amp;u=0dc53e223" onclick="InjectAPI('{&quot;profile_id&quot; : &quot;1961&quot;, &quot;type&quot;:&quot;user&quot;}', event);">
								<h4 class="user">{{NickName}}</h4>
							</a>
						</span>
						<div class="reply-text" data-post-comm-reply-text="{{Id}}">{{Content}}</div>
						{{#ListAudios.length}}
					<div class="post-file" style="padding: 10px;">
						{{#ListAudios}}
						<audio controls="" preload="auto">
							<source src="{{.}}" type="audio/mpeg">
							<source src="{{.}}" type="audio/mp3">
						</audio>
						{{/ListAudios}}
					</div>
						{{/ListAudios.length}}
						{{#ListImages}}
						<div id="fullsizeimg" style="position: relative;padding: 10px;">
							<img onclick="OpenLightBox('{{.}}','{{Id}}')" src="{{.}}" alt="image" class="width-2 image-file pointer">

							<div class="clear">
							</div>
						</div>
						{{/ListImages}}
					</div>
					<div class="clear"></div>
				</div>

				<!-- reaction -->
				<div class="like-stat stat-item" id="comment_reacted">
					<span class="like-emo replay-reactions-icons-{{Id}}">
					</span>
				</div>

				<div class="comment-options">
					<div class="wo-reaction wo-reaction-replay stat-item" data-id="{{Id}}" id="comment_reactions">
						<span class="like-btn like-btn-replay" data-id="{{Id}}">
							<span class="replay-status-reaction-{{Id}}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-thumbs-up"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg> <span class="r_likes-6620"></span></span>
						</span>
					</div>
					· <span class="time ajax-time" title="">{{CreatedTime}}</span>
				</div>
				<div class="hidden" data-post-comm-reply-edit="6620">
					<textarea class="edit-box form-control" onkeydown="Wo_UpdatCommReply('{{Id}}',event,this)">{{Content}}</textarea>
				</div>
			</div>
		</div>
	</script>
	<script id="comment-template" type="x-tmpl-mustache">
		<div class="comment comment-container" id="comment_{{Id}}" data-comment-id="{{Id}}">
			<a class="pull-left" href="/profile?id={{UserId}}">
				<img class="avatar pull-left" src="{{Avatar}}" alt="avatar">
			</a>
			<div class="comment-body">
				<div class="comment-heading">
					<div class="sun_innr_comm">
						<span class="user-popover" data-id="5" data-type="user">
							<a href="/profile?id={{UserId}}">
								<h4 class="user">{{NickName}}</h4>
							</a>
						</span>
						<div class="comment-text" style="max-height: none;">{{Content}}</div>
						{{#ListAudios.length}}
					<div class="post-file" style="padding: 10px;">
						{{#ListAudios}}
						<audio controls="" preload="auto">
							<source src="{{.}}" type="audio/mpeg">
							<source src="{{.}}" type="audio/mp3">
						</audio>
						{{/ListAudios}}
					</div>
						{{/ListAudios.length}}
						{{#ListImages}}
						<div id="fullsizeimg" style="position: relative;padding: 10px;">
							<img onclick="OpenLightBox('{{.}}','{{Id}}')" src="{{.}}" alt="image" class="width-2 image-file pointer">

							<div class="clear">
							</div>
						</div>
						{{/ListImages}}
					</div>
					<div class="clear"></div>
				</div>

				<!-- reaction -->
				<div class="like-stat stat-item post-like-status" id="comment_reacted">
					<span class="like-emo comment-reactions-icons-{{Id}}">
					</span>
				</div>

				<span class="comment-options">
					<span id="LikeAction_{{Id}}" onclick="LikeAction('{{Id}}')" data-id="6972">
						<span class="comment-status-reaction-6972 unselectable"><i class="fa fa-thumbs-up fa-lg fa-flip-horizontal"></i> <span id="CountEmotions_{{Id}}" class="how_many_reacts">{{CountEmotions}}</span></span>
					</span>
					·
					<span class="pointer" id="ReplyComment" onclick="OpenReplyBox('{{Id}}','');">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
					</span>
					<span id="comment-replies">{{CountReply}}</span>
					·
					<span class="time ajax-time" title="">{{CreatedTime}}</span>
				</span>
				<div class="comment-replies-{{Id}}" style="display: none;">
					<div class="comment-replies-text" id="comments-list-{{Id}}">

					</div>
					<div class="comment-reply">
						<div class="wo_commreply_combo">
							<img class="avatar" src="{{Avatar}}">
							<textarea data-holder="image-holder-comment-reply-{{Id}}" class="reply-box form-control textarea" onkeyup="CreatedComment(this, '{{Id}}','@TypeComment.COMMENT')" placeholder="Reply to comment" dir="auto" style="height: 48px;"></textarea>
						</div>
						<div id="hidden_inputbox_comment_reply"></div>
					</div>
					<div style="position:relative;">
						<div id="album-form">
							<div class="publisher-hidden-option">
								<input name="album_name" type="text" class="form-control" placeholder="Album name">
							</div>
						</div>
						<div class="publisher-hidden-option" id="photo-form-reply-{{Id}}">
							<div id="image-holder" style="overflow-x: auto;"><div id="image-holder-comment-reply-{{Id}}"></div></div>
						</div>
						<div class="publisher-hidden-option" id="audio-form">
							<div style="overflow-x: auto;"><div id="audio-holder-comment-{{Id}}"></div></div>
						</div>
					</div>
					<div class="sun_pub_more">
						<div style="margin:0px" class="sun_pub_more_items">
							<!--Uploaded Image-->
							<div style="margin:0px" class="poster-left-buttons">
								<span class="btn btn-file img">
									<span style="float: left;margin-right: 10px;">
										<img src="https://biztime.com.vn/themes/biztime-s/img/icons/pub-img.svg" alt="Kèm ảnh">
									</span>
									<span>Kèm ảnh</span>
									<input type="file" class="publisher-photos" onchange="GetImage(this)" data-holder="photo-form-reply-{{Id}}" data-photos="image-holder-comment-reply-{{Id}}" accept="image/x-png, image/gif, image/jpeg" name="postPhotos[]" multiple="multiple">
								</span>
							</div>

						</div>
						<!--Record Audio-->
						<div style="margin:0px" class="sun_pub_more_items" id="recordPostAudioWrapper">
							<div style="margin:0px" class="poster-left-buttons">
								<span class="btn btn-file rec">
									<span class="record-comment-audio" style="float: left;margin-right: 10px;" data-audio-holder="audio-holder-comment-{{Id}}" id="record-comment-audio-{{Id}}" data-audio="audio-holder-comment-{{Id}}" data-record="0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg></span><span>Ghi âm</span>
								</span>
								<span id="postRecordingTime" class="hidden">00:00</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</script>
	<script id="my-template" type="x-tmpl-mustache">
		<div class="post-container sun_post">
			<div class="post" id="post-{{Id}}" data-post-id="{{Id}}" data-post-type="">
				<div class="panel panel-white panel-shadow">
					<div class="post-heading">
						<div class="pull-left image">
							<a href="/profile?id={{UserId}}"><img src="{{Avatar}}" id="updateImage-4" class="avatar" alt="{{NickName}} profile picture"></a>
						</div>
						<div class="meta">
							<div class="title h5" style="display:flex">
								<span class="user-popover" data-type="user" data-id="4"><a href="/profile?id={{UserId}}"><b>{{NickName}}</b></a></span><div class="{{ShowTarget}}"><i class="fa fa-long-arrow-right"></i><span class="user-popover" data-type="user" data-id="4"><a href="{{TargetId}}"><b>{{TargetNickName}}</b></a></span></div><small class="small-text"></small>
							</div><h6> <span class="time">&nbsp;&nbsp;<a style="color:#9197a3" class="ajax-time" title="" target="_blank">{{CreatedTime}}</a></span></h6>
						</div>
					</div>
					<div class="post-description" id="post-description-{{Id}}">
						<p dir="auto" data-readmore="" aria-expanded="false" id="rmjs-1">
							<span data-translate-text="{{Id}}">
								{{Content}}
							</span>
						</p>
						{{#ListAudios.length}}
					<div class="post-file">
						{{#ListAudios}}
						<audio controls="" preload="auto">
							<source src="{{.}}" type="audio/mpeg">
							<source src="{{.}}" type="audio/mp3">
						</audio>
						{{/ListAudios}}

					</div>
						{{/ListAudios.length}}


						<div id="fullsizeimg" style="position: relative;">
							{{#ListImages}}
							<img onclick="OpenLightBox('{{.}}','{{Id}}')" src="{{.}}" alt="image" class="width-2 image-file pointer">
							{{/ListImages}}
							<div class="clear">
							</div>
						</div>

						<div class="stats post-actions pull-left" id="active_react">
							<div class="like-stat stat-item post-like-status">
								<span class="like-emo post-reactions-icons-{{Id}}">
									<i class="fa fa-thumbs-up fa-lg fa-flip-horizontal"></i>
									<span id="CountEmotions_{{Id}}" class="how_many_reacts">{{CountEmotions}}</span>
								</span>
							</div>
						</div> <div class="clear"></div>
						<div class="stats pull-left" id="wo_post_stat_button">
							<div id="LikeAction_{{Id}}" onclick="LikeAction('{{Id}}')" class="wo-reaction wo-reaction-post stat-item unselectable" data-id="{{Id}}">
								<span class="like-btn like-btn-post unselectable" data-id="{{Id}}"><span class="status-reaction-{{Id}} unselectable"><i class="fa fa-thumbs-up fa-lg fa-flip-horizontal"></i> <span class="t_likes{{Id}}"></span> Like</span></span><ul class="reactions-box reactions-box-container-{{Id}}" data-id="{{Id}}" style=" right: auto; "><li class="reaction reaction-like animated_2" data-reaction="Like" data-reaction-lang="Like" data-post-id="{{Id}}" onclick="Wo_RegisterReaction(this);"><img class="" src="https://biztime.com.vn/themes/biztime-s/reaction/like.gif" alt="Like"></li><li class="reaction reaction-love animated_4" data-reaction="Love" data-reaction-lang="Love" data-post-id="{{Id}}" onclick="Wo_RegisterReaction(this);"><img class="" src="https://biztime.com.vn/themes/biztime-s/reaction/love.gif" alt="Love"></li><li class="reaction reaction-haha animated_6" data-reaction="HaHa" data-reaction-lang="HaHa" data-post-id="{{Id}}" onclick="Wo_RegisterReaction(this);"><img class="" src="https://biztime.com.vn/themes/biztime-s/reaction/haha.gif" alt="HaHa"></li><li class="reaction reaction-wow animated_8" data-reaction="Wow" data-reaction-lang="WoW" data-post-id="{{Id}}" onclick="Wo_RegisterReaction(this);"><img class="" src="https://biztime.com.vn/themes/biztime-s/reaction/wow.gif" alt="WoW"></li><li class="reaction reaction-sad animated_10" data-reaction="Sad" data-reaction-lang="Sad" data-post-id="{{Id}}" onclick="Wo_RegisterReaction(this);"><img class="" src="https://biztime.com.vn/themes/biztime-s/reaction/sad.gif" alt="Sad"></li><li class="reaction reaction-angry animated_12" data-reaction="Angry" data-reaction-lang="Angry" data-post-id="{{Id}}" onclick="Wo_RegisterReaction(this);"><img class="" src="https://biztime.com.vn/themes/biztime-s/reaction/angry.gif" alt="Angry"></li></ul>
							</div><div class="btn btn-default stat-item" onclick="Wo_ShowComments({{Id}});" title="Comments"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9Z"></path></svg><span class="like-btn-mobile">Comment</span> </div> <div class="btn btn-default stat-item" title="Share" onclick="Wo_SharePostOn('{{Id}}',4,'timeline')">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"></path></svg> <span class="like-btn-mobile">Share</span>
							</div>
						</div>
						<div class="clear"></div>
					</div>
					<div class="post-footer post-comments " id="post-comments-3139">
						<div id="hidden_inputbox_comment"></div>
						<div id="comments-list-{{Id}}" class="comments-list">

						</div>

						<div class="post-commet-textarea">
							<div class="loading_cont">
								<div class="loading hidden"></div>
							</div>
							<div id="wo_comment_combo" class="remove_combo_on_click">
								<div style="display: flex;">
									<img class="avatar" src="{{Avatar}}">
									<textarea data-holder="image-holder-comment-{{Id}}" class="form-control comment-textarea textarea ui-autocomplete-input" placeholder="Write a comment and press enter" type="text" onkeyup="CreatedComment(this, '{{Id}}','@TypeComment.POST');" dir="auto" autocomplete="off" style="height:36px;"></textarea>
								</div>
							</div>
							<div style="position:relative;">
								<div id="album-form">
									<div class="publisher-hidden-option">
										<input name="album_name" type="text" class="form-control" placeholder="Album name">
									</div>
								</div>
								<div class="publisher-hidden-option" id="photo-form-{{Id}}">
									<div id="image-holder" style="overflow-x: auto;"><div id="image-holder-comment-{{Id}}"></div></div>
								</div>
								<div class="publisher-hidden-option" id="audio-form">
									<div style="overflow-x: auto;"><div id="audio-holder-comment-{{Id}}"></div></div>
								</div>
							</div>
							<div class="sun_pub_more">
								<div style="margin:0px" class="sun_pub_more_items">
									<!--Uploaded Image-->
									<div style="margin:0px" class="poster-left-buttons">
										<span class="btn btn-file img">
											<span style="float: left;margin-right: 10px;">
												<img src="https://biztime.com.vn/themes/biztime-s/img/icons/pub-img.svg" alt="Kèm ảnh">
											</span>
											<span>Kèm ảnh</span>
											<input type="file" class="publisher-photos" onchange="GetImage(this)" data-holder="photo-form-{{Id}}" data-photos="image-holder-comment-{{Id}}" accept="image/x-png, image/gif, image/jpeg" name="postPhotos[]" multiple="multiple">
										</span>
									</div>

								</div>
								<!--Record Audio-->
								<div style="margin:0px" class="sun_pub_more_items" id="recordPostAudioWrapper">
									<div style="margin:0px" class="poster-left-buttons">
										<span class="btn btn-file rec">
											<span class="record-comment-audio" style="float: left;margin-right: 10px;" data-audio-holder="audio-holder-comment-{{Id}}" id="record-comment-audio-{{Id}}" data-audio="audio-holder-comment-{{Id}}" data-record="0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg></span><span>Ghi âm</span>
										</span>
										<span id="postRecordingTime" class="hidden">00:00</span>
									</div>
								</div>
							</div>
						</div>
						<div id="comment-image" class="hidden comment-image-con">

						</div>
					</div>
				</div>

			</div>
		</div>
	</script>
	<script>
	var checkLoadPost = false;
	$(document).ready(function () {
		LoadRequestFriend();
	});
	function OpenReplyBox(id, date) {
		$(".comment-replies-" + id).toggle();
		LoadReply(id, date);
	}
	function LoadReply(id, date) {
		 $.ajax({
            url: "/Comment/LoadCommentsReply",
            type: "GET",
			 data: { PostIds: id,date,quantity: "20"},
            dataType: "json",
            success: function (result) {
				if (result.result == @Constant.SUCCESS) {
					var commenttp = $('#comment-template').html();
					Mustache.parse(commenttp);
					if (date == "")
						$("#comments-list-" + id).empty();
					result.data.forEach((comment) => {
						if (comment.CreatedTime != null) {
							comment.CreatedTime = time_ago(new Date(parseInt(comment.CreatedTime.substr(6))));
						}
						var rendercomment = Mustache.render(commenttp, comment);
						$("#comments-list-" + comment.TargetId).append(rendercomment);
					});

				}
            },
            error: function (data) {
            }
        });
	}
	function PushPost(TargetId,TargetType) {
		var postText = $("#publisher-box-focus textarea[name=postText]").val();
		var images = [];
		var audios = "";
		for (var i = 0; i < $("#image-holder-post img.thumb-image").length; i++) {
			images.push($("#image-holder-post img.thumb-image")[i].src);
		}
		$("#audio-holder-post audio").each(function () {
			console.log($(this).attr("data-url"))
			if(audios == "")
				audios += $(this).attr("data-url");
			else
				audios += "," + $(this).attr("data-url");
		})
		var userid = @Model.ID;
            $.ajax({
                url: "/Home/CreatedPost",
                type: "POST",
				data: {Content: postText,UserId:  userid,ListImages:images,Audios : audios,TargetId,TargetType},
                dataType: "json",
                success: function (result) {
					if (result.result == @Constant.SUCCESS) {
						Wo_HidePosInfo();
						EngnestFlash.notice("Created Post success");
						location.reload();
					}
                    else
                        EngnestFlash.error("Created Post error!");
                },
                error: function (data) {
                    EngnestFlash.error("Created Post error!");
                }
            });
	}
	function CreatedComment(that,id,type) {
		var keycode = (event.keyCode ? event.keyCode : event.which);
		if(keycode == '13'){
			var commentText = that.value.trim();
			var userid = @Model.ID;
			var images = [];
			var audios = "";
			
			for (var i = 0; i < $("#"+$(that).data("holder")+" img.thumb-image").length; i++) {
				images.push($("#"+$(that).data("holder")+" img.thumb-image")[i].src);
			}
			$("#audio-holder-comment-"+id+" audio").each(function () {
				console.log($(this).attr("data-url"))
				if(audios == "")
					audios += $(this).attr("data-url");
				else
					audios += "," + $(this).attr("data-url");
			})
			$("#audio-holder-comment-" + id).empty();
			$("#" + $(that).data("holder")).empty();
            $.ajax({
                url: "/Comment/CreatedComment",
                type: "POST",
				data: { Content: commentText, UserId: userid, TargetId: id, TargetType:type,ListImages:images,Audios : audios},
                dataType: "json",
                success: function (result) {
					if (result.result == @Constant.SUCCESS) {
						var commenttp = $('#comment-template').html();
						Mustache.parse(commenttp);
						result.data.forEach((comment) => {
							if (comment.CreatedTime != null) {
								comment.CreatedTime = time_ago(new Date(parseInt(comment.CreatedTime.substr(6))));
							}
							var rendercomment = Mustache.render(commenttp, comment);
							if (type == @TypeComment.COMMENT)
								$("#comments-list-" + comment.TargetId).append(rendercomment);
							else
								$("#comments-list-" + comment.TargetId).prepend(rendercomment);
						});
					}
                },
                error: function (data) {
                }
			});
			that.value = "";
		}
	}

	function LikeAction(id) {
            $.ajax({
                url: "/Home/LikeAction",
                type: "POST",
				data: {PostId: id},
                dataType: "json",
                success: function (result) {
					if (result.result == @Constant.SUCCESS) {
						if (result.status == "1") {
							$("#CountEmotions_" + id).html(parseInt($("#CountEmotions_" + id).html()) + 1);
							$("#LikeAction_" + id).addClass("active-like");
						} else {
							$("#CountEmotions_" + id).html(parseInt($("#CountEmotions_" + id).html()) - 1);
							$("#LikeAction_" + id).removeClass("active-like");
						}
					}
                    else
                        EngnestFlash.error("Created Post error!");
                },
                error: function (data) {
                    EngnestFlash.error("Created Post error!");
                }
            });
	}

	function LoadMoreComment(ids, date, quantity) {
        $.ajax({
            url: "/Comment/LoadCommentsPost",
            type: "GET",
			data: {PostIds: ids.toString(),date,quantity},
            dataType: "json",
            success: function (result) {
				if (result.result == @Constant.SUCCESS) {
					var commenttp = $('#comment-template').html();
					Mustache.parse(commenttp);
					result.data.forEach((comment) => {
						if (comment.CreatedTime != null) {
							comment.CreatedTime = time_ago(new Date(parseInt(comment.CreatedTime.substr(6))));
						}
						var rendercomment = Mustache.render(commenttp, comment);
						$("#comments-list-" + comment.TargetId).append(rendercomment);
						if(comment.StatusEmotion == 1)
							$("#LikeAction_" + comment.Id).addClass("active-like");
					});
				}
            },
            error: function (data) {
            }
        });
	}
	function LoadRequestFriend() {
    $.ajax({
        url: "/Home/LoadRequestFriend",
        type: "GET",
		data: {},
        dataType: "json",
        success: function (result) {
			if (result.result == @Constant.SUCCESS) {
				if (result.data.length != 0) {
					$("#alert-request").html(result.data.length);
					$("#requests-list").empty();
				}
				result.data.forEach((request) => {
					var html = '<li class="row">'+
									'<div class="user-request-list user-follow-request-'+ request.Id +'">' +
										'<div class="user-info">' +
										'<a href="/'+ request.TargetId +'">' +
											'<div class="avatar">' +
												'<img src="'+ request.Avatar +'" alt="'+ request.NickName +' Profile Picture">' +
											'</div>' +
										''+ request.NickName +'</a>' +
										'</div>' +
										'<div class="accept-btns user-follow-button">' +
											'<button type="button" id="accept-'+ request.Id +'" onclick="AcceptRequest('+ request.Id +')" class="btn btn-default btn-sm btn-active" title="Accept">' +
												'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>' +
											'</button>' +
											'<button type="button" id="delete-'+ request.Id +'" onclick="DeleteRequest('+ request.Id +')" class="btn btn-default btn-sm" title="Delete">' +
												'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>' +
											'</button>' +
										'</div>' +
									'</div>' +
								'</li>';
					$("#requests-list").append(html)
				});
			}
        },
        error: function (data) {
        }
    });
	}


	</script>
	@RenderSection("scripts", required: false)
	<script type="text/javascript">
		function Wo_ShowPosInfo() {
			$(".postText").attr('opened', '1');
			$(".postText").css('height', '112px').focus();
			$("body").addClass('pub-focus');
			$(".publisher-box-footer").slideDown(100);
			$(".add-emoticons").addClass('show_emo');
		}
		$('#focus-overlay').on('click', function () {
			Wo_HidePosInfo();
		});

		function Wo_HidePosInfo() {
			$(".postText").attr('opened', '0');
			$(".postText").css('height', '112px');
			$("body").removeClass('pub-focus');
			$(".publisher-box-footer").slideUp(100);
			$(".add-emoticons").removeClass('show_emo');
			fetch_url = 1;
		}
		$('.map-form').click(function () {
			$('#map-form').slideToggle(200);
			$('#map-form input').focus();
		});
	</script>

	<script>
		var chat = $.connection.chatHub;
		$.ajax({
                url: "/Profile/LoadFriend",
                type: "POST",
				data: {},
                dataType: "json",
                success: function (result) {
					if (result.result == @Constant.SUCCESS) {
						var friendtp = $('#friend-template').html();
						Mustache.parse(friendtp);
						result.data.forEach((friend) => {
							var renderfriend = Mustache.render(friendtp, friend);
							$("#users-chat").append(renderfriend);
						});
					}
                },
                error: function (data) {
                }
        });
		$(function () {
			// Reference the auto-generated proxy for the hub.
			// Get the user name and store it to prepend to messages.
			// Set initial focus to message input box.
			$('#message').focus();
			// Start the connection.
			chat.client.addChatMessage = function (message) {
				var obj = JSON.parse(message);
				var html = '<div class="messages-wrapper pull-left messages-text">' +
					'<div class="message outgoing pull-left">' +
					'<p class="message-text" dir="auto" style=" color:#fff !important;">' +
					obj.Content +
					'</p><div class="clear"></div><div class="message-media"></div></div></div>';
				if ($(".chat_main_" + obj.UserID).length == 0)
					OpenChatTab(obj.UserID);
				$(".chat_main_"+obj.UserID+" .chat-messages").append(html)
			};
			$.connection.hub.start().done(function () {
				chat.server.connected(@Model.ID);
				$('#sendmessage').click(function () {
					// Call the Send method on the hub.
					chat.server.sendChatMessage(@Model.ID, $('#message').val());
					// Clear text box and reset focus for next comment.
					$('#message').val('').focus();
				});

			});

		});
		// This optional function html-encodes messages for display in the page.
		function htmlEncode(value) {
			var encodedValue = $('<div />').text(value).html();
			return encodedValue;
		}
	</script>
	<script>
	function OpenChatTab(targetId) {
		if ($(".chat_main_" + targetId).length != 0)
			return;
		var userid = @Model.ID;
        $.ajax({
            url: "/Message/LoadMessages",
            type: "POST",
			data: {UserId: userid,TargetId:  targetId},
            dataType: "json",
            success: function (result) {
				if (result.result == @Constant.SUCCESS) {
					var chattp = $('#chat-template').html();
					Mustache.parse(chattp);
					var a = {};
					a.Id = targetId;
					if (result.data.length != 0) {
						a.NickNameTarget = result.data[0].NickNameTarget;
						a.AvataTarget = result.data[0].AvataTarget;
					}
					
					var rendercomment = Mustache.render(chattp, a);
					$(".chat-tab").append(rendercomment);
					result.data.reverse();
					result.data.forEach((message) => {
						if (message.CreatedTime != null) {
							message.CreatedTime = time_ago(new Date(parseInt(message.CreatedTime.substr(6))));
						}
						var html = "";
						if(message.UserId == userid)
							html = '<div class="messages-wrapper pull-right messages-text">' +
							'<div class="message outgoing pull-right">' +
							'<p class="message-text" dir="auto" style=" color:#fff !important;">' +
							message.Content +
								'</p><div class="clear"></div><div class="message-media"></div></div><div class="date-message pull-right">'+message.CreatedTime+'</div></div>';
						else
							html = '<div class="messages-wrapper pull-left messages-text">' +
							'<div class="message outgoing pull-left">' +
							'<p class="message-text" dir="auto" style=" color:#fff !important;">' +
							message.Content +
								'</p><div class="clear"></div><div class="message-media"></div></div><div class="date-message">'+message.CreatedTime+'</div></div>';
						$(".chat_main_"+targetId+" .chat-messages").append(html)
					});
				}
            },
            error: function (data) {
            }
        });
	}
	function CloseChat(targetId) {
		$(".chat_main_" + targetId).remove();
	}
	function CreatedGroup(that) {
		var groupname =$("#groupname").value;
		var userid = @Model.ID;
		$.ajax({
			url: "/Home/CreatedGroup",
			type: "POST",
			data: {GroupName: groupname,UserID:  userid},
			dataType: "json",
			success: function (result) {
				if (result.result == @Constant.SUCCESS) {
					CloseLightbox();
					EngnestFlash.notice("Created group success!");
					location.href = "Group?id=" + result.data;
				}
				else {
					EngnestFlash.notice("Created group unsuccess!");
				}
			},
			error: function (data) {
			}
		});
	}
	function CreatedMessage(that,id) {
			var keycode = (event.keyCode ? event.keyCode : event.which);
			if(keycode == '13'){
				var MessageText = that.value.trim();
				var userid = @Model.ID;
				$.ajax({
					url: "/Message/CreatedMessage",
					type: "POST",
					data: {Content: MessageText,UserID:  userid,TargetUser:id},
					dataType: "json",
					success: function (result) {
						if (result.result == @Constant.SUCCESS) {
							var obj = {};
							obj.Content = MessageText;
							obj.UserID = userid;
							obj.TargetUser = id;
							var myJSON = JSON.stringify(obj);
							chat.server.sendChatMessage(id, myJSON);
							var html = '<div class="messages-wrapper pull-right messages-text">' +
								'<div class="message outgoing pull-right">' +
								'<p class="message-text" dir="auto" style=" color:#fff !important;">' +
								obj.Content +
								'</p><div class="clear"></div><div class="message-media"></div></div><div class="date-message pull-right">now</div></div>';
							$(".chat_main_"+id+" .chat-messages").append(html)
						}
					},
					error: function (data) {
					}
				});
				that.value = "";
			}
	}
	function OpenLightBox(image,id) {
	  $('#contnet').append('<div class="lightbox-container"><div class="lightbox-backgrond" onclick="CloseLightbox();"></div><div class="lightbox-content post wo_imagecombo_lbox lightpost-'+id+'" id="post-'+id+'" data-post-id="'+id+'">'+
	'<div class="story-img">'+
		'<div class="sun_img_innr">'+
		'<div id="draggableHelper" style="display: table-cell; vertical-align: middle; position: relative;" class="ui-draggable ui-draggable-handle">'+
				      		'<img src="'+image+'" alt="media" class="double_zoom" id="wo_zoom_'+id+'" style="transform: rotate(-360deg);">'+
	      			'</div>'+
		'</div>'+
		'<div class="wo_lbox_topbar sun_light_tool">'+
			'<span class="lbox_topbar_child">'+
				'<span>'+
					'<a href="'+image+'" target="_blank">Open original</a>'+
				'</span>'+
			'</span>'+
					'<span class="lbox_topbar_child right">'+
								'<span onclick="rotate(\''+id+'\')">'+
					'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7.47,21.5C4.2,19.93 1.86,16.76 1.5,13H0C0.5,19.16 5.66,24 11.95,24C12.18,24 12.39,24 12.61,23.97L8.8,20.15L7.47,21.5M12.05,0C11.82,0 11.61,0 11.39,0.04L15.2,3.85L16.53,2.5C19.8,4.07 22.14,7.24 22.5,11H24C23.5,4.84 18.34,0 12.05,0M16,14H18V8C18,6.89 17.1,6 16,6H10V8H16V14M8,16V4H6V6H4V8H6V16A2,2 0 0,0 8,18H16V20H18V18H20V16H8Z"></path></svg>'+
				'</span>'+
			'</span>'+
		'</div>'+
	'</div>'+
'</div></div>');
	}
	function CloseLightbox() {
	  $('.lightbox-container').remove();
	  document.body.style.overflow = 'auto';
	}
	function PopupCreatedGroup() {
		var html =	'<div class="lightbox-container">' +
						'<div class="lightbox-backgrond" onclick="CloseLightbox();"></div>'+
						'<div class="lightbox-content post wo_imagecombo_lbox created-group" style="max-height: 250px;">' +
							'<div class="story-img">'+
								'<div class="sun_img_innr" id="wo_comment_combo">'+
									'<h2 style="text-align: center;">Group Name</h2>' +
			'<div style="display: flex;"><textarea id="groupname" class="form-control comment-textarea textarea ui-autocomplete-input" type="text" dir="auto" autocomplete="off" style="height:36px;"></textarea></div>' +
			'<div style="display: flex;"><button style="margin: 20px calc(25% - 40px);" type="button" class="btn btn-success" onclick="CreatedGroup()" >Create</button><button style="margin: 20px calc(25% - 40px);" type="button" class="btn btn-default" onclick="CloseLightbox()">Cancel</button></div>'+
								'</div>'+
							'</div>' +
						'</div>' +
					'</div>';
	  $('#contnet').append(html);
	}
	</script>

	<script type="text/javascript">
		function UploadAvatar(that) {
			deleted_images = [];
			//Get count of selected files
			var countFiles = $(that)[0].files.length;
			var imgPath = $(that)[0].value;
			var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
			if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
				if (typeof (FileReader) != "undefined") {
					//loop for each file selected for uploaded.
					for (var i = 0; i < countFiles; i++) {
						var reader = new FileReader();
						reader.onload = function (e) {
							$.ajax({
								url: "/Profile/UploadAvatar",
								type: "POST",
								data: {Avatar: e.target.result},
								dataType: "json",
								success: function (result) {
									if (result.result == @Constant.SUCCESS) {
										EngnestFlash.notice("Update avatar success!");
										window.location.reload();
									}
									else {
										EngnestFlash.notice("Update avatar unsuccess!");
									}
								},
								error: function (data) {
								}
							});
						}
						reader.readAsDataURL($(that)[0].files[i]);
					}
				} else {
					image_holder.html("<p>This browser does not support FileReader.</p>");
				}
			}
	}
		function UploadBackGround(that) {
			deleted_images = [];
			//Get count of selected files
			var countFiles = $(that)[0].files.length;
			var imgPath = $(that)[0].value;
			var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
			if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
				if (typeof (FileReader) != "undefined") {
					//loop for each file selected for uploaded.
					for (var i = 0; i < countFiles; i++) {
						var reader = new FileReader();
						reader.onload = function (e) {
							$.ajax({
								url: "/Profile/UploadBackGround",
								type: "POST",
								data: {BackGround: e.target.result},
								dataType: "json",
								success: function (result) {
									if (result.result == @Constant.SUCCESS) {
										EngnestFlash.notice("Update BackGround success!");
										window.location.reload();
									}
									else {
										EngnestFlash.notice("Update BackGround unsuccess!");
									}
								},
								error: function (data) {
								}
							});
						}
						reader.readAsDataURL($(that)[0].files[i]);
					}
				} else {
					image_holder.html("<p>This browser does not support FileReader.</p>");
				}
			}
		}
		function GetImage(that) {
			deleted_images = [];
			//Get count of selected files
			var countFiles = $(that)[0].files.length;
			var imgPath = $(that)[0].value;
			var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
			var image_holder = $("#" + $(that).data('photos'));
			image_holder.empty();
			if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
				if (typeof (FileReader) != "undefined") {
					//loop for each file selected for uploaded.
					for (var i = 0; i < countFiles; i++) {
						var reader = new FileReader();
						var ii = 0;
						reader.onload = function (e) {
							name = "'" + $(that)[0].files[ii].name + "'";
							image_holder.append('<span class="thumb-image-delete" id="image_to_' + ii + '"><span onclick="DeleteImageById(' + name + ',' + ii + ')" class="pointer thumb-image-delete-btn"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg></span><img src="' + e.target.result + '" class="thumb-image"></span>')
							ii = ii + 1;
							// $("<img />", {
							//                 "src": e.target.result,
							//                 "class": "thumb-image"
							//               }).appendTo(image_holder);
						}
						image_holder.show();
						reader.readAsDataURL($(that)[0].files[i]);
					}
				} else {
					image_holder.html("<p>This browser does not support FileReader.</p>");
				}
			}
			if ($(that).data("photos") == "image-holder-post") {
				var numFiles = that.files.length;
				$("#photo-form input").val(numFiles + ' photo(s) selected');
				$("#photo-form").slideDown(200);
			}
			else
				$("#" + $(that).data("holder")).slideDown(200);
		}
		function Wo_ChangeColor(color_1, color_2, text_color, image, id) {
			if (color_1 != '' && color_2 != '' && text_color != '' && id) {
				$('.wo_pub_txtara_combo').css("cssText", "background-image: linear-gradient(45deg, " + color_1 + " 0%, " + color_2 + " 100%) !important");
				$('.postText').css("cssText", "color: " + text_color + " !important");
				$('#post_color_input').val(id);
				$('.post.publisher-box').addClass('wo_pub_change_color');
			}
			else if (text_color != '' && image != '' && id) {
				$('.wo_pub_txtara_combo').css("cssText", "background-position: center !important;background-repeat: no-repeat !important;background-size: cover !important;background-image:url('" + image + "') !important;");
				$('.postText').css("cssText", "color: " + text_color + " !important");
				$('#post_color_input').val(id);
				$('.post.publisher-box').addClass('wo_pub_change_color');
			}
		}
		function Wo_ShowColors() {
			if ($('.all_colors').is(":visible")) {
				$('.all_colors').hide();
				$('.postText').css("cssText", "");
				$('#post_color_input').val("");
				$('.post.publisher-box').removeClass('wo_pub_change_color');
			}
			else {
				$('.all_colors').show();
			}
		}
		function Wo_CloseColor() {
			$('.all_colors').hide();
			$('.wo_pub_txtara_combo').css("cssText", "");
			$('.postText').css("cssText", "");
			$('#post_color_input').val("");
			$('.post.publisher-box').removeClass('wo_pub_change_color');
			$(".all_colors_display").removeClass('selected');
		}

		$(document).ready(function () {
			$(".sun_pub_privacy_dropdown").click(function () {
				$(".sun_pub_privacy").toggleClass("showMenu");
				$(".sun_pub_privacy_menu > li").click(function () {
					$(".sun_pub_privacy_dropdown > p").html($(this).find('span').html());
					$(".sun_pub_privacy").removeClass("showMenu");
				});
			});
		});

		jQuery(document).click(function (event) {
			if (!(jQuery(event.target).closest(".sun_pub_privacy").length)) {
				jQuery('.sun_pub_privacy').removeClass('showMenu');
			}
		});

		var deleted_images = [];
		function DeleteImageById(name, id) {
			deleted_images.push(name);
			$('#image_to_' + id).remove();
		}

		$(document).ready(function () {
			$("textarea.postText").keyup(function () {
				if ($(this).val().length > 180) {
					$('.all_colors').hide();
					$('.postText').css("cssText", "");
					$('#post_color_input').val("");
					$('.post.publisher-box').removeClass('wo_pub_change_color');
					$(".all_colors_display").removeClass('selected');
				}
				else {

				}
			});

			$(".all_colors_display").click(function () {
				$(".all_colors_display").removeClass('selected');
				$(this).addClass('selected');
			});

			$(".publisher-photos").on('change', function () {
				GetImage(this);
			});

			var allowed = "jpg,png,jpeg,gif,pptx,docx,pdf,doc,mp3,mp4,flv,wav,txt,mov,avi,wav,mpeg";
			$('.emo-form').click(function () {
				$('#emo-form').slideToggle(200);
				Wo_RestFeelings();
			});

			$('.gif-form').click(function () {
				$('#gif-form').slideToggle(200);
			});

			$('.map-form').click(function () {
				$('#map-form').slideToggle(200);
				$('#map-form input').focus();
			});
			$('.poll-form').click(function () {
				$('#poll-form').slideToggle(200);
				$('.answers').find('input').each(function (index_id) {
					$(this).val('');
				});
			});
			$("#publisher-file").change(function () {
				var filename = $(this).val().replace(/C:\\fakepath\\/i, '');
				$("#file-form input").val(filename);
				$("#file-form").slideDown(200);
				if (Wo_IsFileAllowedToUpload(filename, allowed) == false) {
					$("#file_not_supported").modal('show');
					Wo_Delay(function () {
						$("#file_not_supported").modal('hide');
					}, 3000);
					$("#publisher-file").val('');
					$("#file-form input").val('');
					$("#file-form").slideUp(200);
					return false;
				}
			});

			//$(".publisher-photos").change(function () {
			//	if ($(this).data("photos") == "image-holder-post") {
			//		var numFiles = this.files.length;
			//		$("#photo-form input").val(numFiles + ' photo(s) selected');
			//		$("#photo-form").slideDown(200);
			//	}
			//	else
			//		$("#photo-form").slideDown(200);
			//});

			$("#publisher-video").change(function () {
				var filename = $(this).val().replace(/C:\\fakepath\\/i, '');
				$("#video-form input[type='text']").val(filename);
				$("#video-form").slideDown(200);
				if (Wo_IsFileAllowedToUpload(filename, allowed) == false) {
					$("#file_not_supported").modal('show');
					Wo_Delay(function () {
						$("#file_not_supported").modal('hide');
					}, 3000);
					$("#publisher-video").val('');
					$("#video-form input[type='text']").val('');
					$("#video-form").slideUp(200);
					return false;
				}
			});

			$("#custom-video-thumb").change(function (event) {
				$("#post_vthumb_droparea").find('.preview').hide(5, function () {
					$("#post_vthumb_droparea").find('.image').html($("<img>", {
						src: window.URL.createObjectURL(event.target.files[0])
					})).show(5);
				});;
			});

			$(".video-custom-thumb").click(function (event) {
				$(this).find('i').toggleClass('rotate-90d');

				$('.video-poster-image').slideToggle(100, function () {
					var display_stat = $(this).css('display');
					if (display_stat == 'none') {
						$(".video-poster-image").find('.preview').show(10);
						$(".video-poster-image").find('.image').empty().hide(10);
						$("#custom-video-thumb").val('');
					}

				});
			});
		});

	</script>
	<script>
		jQuery(document).ready(function ($) {
			try {
				window.AudioContext = window.AudioContext || window.webkitAudioContext;
				navigator.getUserMedia = navigator.getUserMedia
					|| navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
				window.URL = window.URL || window.webkitURL;

			}
			catch (e) {
				console.log('There is no support audio in this browser');
			}
			$(document).on('click', "#recordPostAudio", function (event) {
				audio_context = new AudioContext;
				var _SELF = $(this);
				if (!localstream) {
					Wo_CreateUserMedia();
				}
				Wo_Delay(function () {
					if (localstream && recorder && _SELF.attr('data-record') == 0 && Wo_IsRecordingBufferClean()) {
						Wo_CleanRecordNodes();
						recording_time = $('#postRecordingTime');
						recording_node = "post";
						_SELF.attr('data-record', '1').html('<img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNTggNTgiIHhtbDpzcGFjZT0icHJlc2VydmUiPiA8Y2lyY2xlIHN0eWxlPSJmaWxsOiNENzVBNEE7IiBjeD0iMjkiIGN5PSIyOSIgcj0iMjkiLz4gPGc+IDxyZWN0IHg9IjE2IiB5PSIxNiIgc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHdpZHRoPSIyNiIgaGVpZ2h0PSIyNiIvPiA8cGF0aCBzdHlsZT0iZmlsbDojRkZGRkZGOyIgZD0iTTQzLDQzSDE1VjE1aDI4VjQzeiBNMTcsNDFoMjRWMTdIMTdWNDF6Ii8+IDwvZz4gPC9zdmc+" />');
						Wo_startRecording();
					}
					else if (recorder && _SELF.attr('data-record') == 1 && $("[data-record='1']").length == 1) {
						Wo_stopRecording();
						_SELF.html('<svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 24 24"><path fill="#ff3a55" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"></path></svg>').attr('data-record', '0');
						if (recorder && recording_node == "post") {
							recorder.exportWAV(function (blob) {
								if (blob instanceof Blob && blob.size > 50) {
									var form = new FormData();
									form.append("file", blob);
									$.ajax({
										type: "POST",
										url: "/Home/CreatedAudio",
										data: form,
										processData: false,
										contentType: false,
										success: function (result) {
											if (result.result == "0") {
												$("#audio-holder-post").append("<audio data-url='" + result.key + "' controls='' preload='auto'><source src='" + result.data + "' type='audio/mpeg' ><source src='" + result.data + "' type='audio/mp3'></audio>")
											}
										},
										error: function (data) {
										}
									});
								}
							});
						}
						Wo_CleanRecordNodes();
						Wo_StopLocalStream();
					}
					else {
						return false;
					}
				}, 500);
			});

			$(document).on('click', ".record-comment-audio", function (event) {
				audio_context = new AudioContext;
				var _SELF = $(this);
				if (!localstream) {
					Wo_CreateUserMedia();
				}
				Wo_Delay(function () {
					if (recorder && _SELF.attr('data-record') == 0 && Wo_IsRecordingBufferClean()) {
						Wo_CleanRecordNodes();
						recording_time = $("span[data-comment-rtime='" + _SELF.attr('id') + "']");
						recording_node = "comm";
						comm_field = _SELF.attr('id');
						_SELF.attr('data-record', '1').html('<img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNTggNTgiIHhtbDpzcGFjZT0icHJlc2VydmUiPiA8Y2lyY2xlIHN0eWxlPSJmaWxsOiNENzVBNEE7IiBjeD0iMjkiIGN5PSIyOSIgcj0iMjkiLz4gPGc+IDxyZWN0IHg9IjE2IiB5PSIxNiIgc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHdpZHRoPSIyNiIgaGVpZ2h0PSIyNiIvPiA8cGF0aCBzdHlsZT0iZmlsbDojRkZGRkZGOyIgZD0iTTQzLDQzSDE1VjE1aDI4VjQzeiBNMTcsNDFoMjRWMTdIMTdWNDF6Ii8+IDwvZz4gPC9zdmc+" />');
						Wo_startRecording();
					}

					else if (recorder && _SELF.attr('data-record') == 1 && $("[data-record='1']").length == 1) {
						Wo_stopRecording();
						if (recorder && recording_node == "comm") {
							recorder.exportWAV(function (blob) {
								if (blob instanceof Blob && blob.size > 50) {
									var form = new FormData();
									form.append("file", blob);
									$.ajax({
										type: "POST",
										url: "/Home/CreatedAudio",
										data: form,
										processData: false,
										contentType: false,
										success: function (result) {
											if (result.result == "0") {
												$("#" + _SELF.data("audio-holder")).append("<audio data-url='" + result.key + "' controls='' preload='auto' ><source src='" + result.data + "' type='audio/mpeg' ><source src='" + result.data + "' type='audio/mp3'></audio>")
											}
										},
										error: function (data) {
										}
									});
								}
							});
						}
						Wo_CleanRecordNodes();
						Wo_StopLocalStream();
					}
					else {
						return false;
					}
				}, 500);

			});

			$(document).on('click', ".record-chat-audio", function (event) {
				audio_context = new AudioContext;
				var _SELF = $(this);
				if (!localstream) {
					Wo_CreateUserMedia();
				}
				Wo_Delay(function () {
					if (recorder && _SELF.attr('data-record') == 0 && Wo_IsRecordingBufferClean() && $("[data-record='1']").length == 0) {
						Wo_CleanRecordNodes();
						recording_time = $("span[data-chat-rtime='" + _SELF.attr('data-chat-tab') + "']");
						recording_node = "chat";
						chat_tab = _SELF.attr('data-chat-tab');
						_SELF.attr('data-record', '1').html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M9,9H15V15H9" /></svg><p><?php echo $wo["lang"]["stop"];?></p>');
						Wo_startRecording();
					}

					else if (recorder && _SELF.attr('data-record') == 1 && $("[data-record='1']").length == 1) {
						Wo_stopRecording();
						_SELF.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M20.37,8.91L19.37,10.64L7.24,3.64L8.24,1.91L11.28,3.66L12.64,3.29L16.97,5.79L17.34,7.16L20.37,8.91M6,19V7H11.07L18,11V19A2,2 0 0,1 16,21H8A2,2 0 0,1 6,19Z" /></svg><p><?php echo $wo["lang"]["delete"];?></p>').attr('data-record', '2');
					}

					else if (recorder && _SELF.attr('data-record') == 2) {
						Wo_CleanRecordNodes();
						Wo_StopLocalStream();
						_SELF.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z" /></svg><p><?php echo $wo["lang"]["voice"];?></p>').attr('data-record', '0');
					}

					else {
						return false;
					}
				}, 500);

			});

			$(document).on('click', "#messages-record", function (event) {
				audio_context = new AudioContext;
				var _SELF = $(this);
				if (!localstream) {
					Wo_CreateUserMedia();
				}
				Wo_Delay(function () {
					if (recorder && _SELF.attr('data-record') == 0 && Wo_IsRecordingBufferClean() && $("[data-record='1']").length == 0) {
						Wo_CleanRecordNodes();
						recording_time = $("span.messages-rtime");
						recording_node = "msg";
						_SELF.attr('data-record', '1').html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-stop-circle main"><circle cx="12" cy="12" r="10"></circle><rect x="9" y="9" width="6" height="6"></rect></svg>');
						Wo_startRecording();
					}

					else if (recorder && _SELF.attr('data-record') == 1 && $("[data-record='1']").length == 1) {
						Wo_stopRecording();
						_SELF.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>').attr('data-record', '2');
					}

					else if (recorder && _SELF.attr('data-record') == 2) {
						Wo_CleanRecordNodes();
						Wo_StopLocalStream();
						_SELF.html('<svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 24 24"><path fill="#ff3a55" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"></path></svg>').attr('data-record', '0');
					}

					else {
						return false;
					}
				}, 500);

			});
		});

		function Wo_IsRecordingBufferClean() {
			return $("[data-record='1']").length == 0;
		}

		function Wo_CreateUserMedia() {
			navigator.getUserMedia({ audio: true }, Wo_startUserMedia, function (e) {
				console.log('Could not get input or something went wrong: ' + e);
			});
		}
		function Wo_CleanRecordNodes() {
			$(".record-comment-audio").each(function (index, el) {
				$(el).html('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"></path></svg>').attr('data-record', '0');
				$('[data-comment-rtime="' + $(el).attr('id') + '"]').text('00:00').addClass('hidden');
			});

			$(".record-chat-audio").each(function (index, el) {
				$(el).html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z" /></svg><p><?php echo $wo["lang"]["voice"];?></p>').attr('data-record', '0');
				$('[data-chat-rtime="' + $(el).attr('data-chat-tab') + '"]').text('00:00').addClass('hidden');
			});

			recorder && recorder.clear();
			recorder && clearTimeout(wo_timeout);
			Wo_clearPRecording();
			Wo_clearMRecording();
		}

		function Wo_ClearTimeout() {
			clearTimeout(wo_timeout);
		}
		function Wo_ShowRecordingTime(self) {
			var time = self.text();
			var seconds = time.split(":");
			var date = new Date();
			date.setHours(0);
			date.setMinutes(seconds[0]);
			date.setSeconds(seconds[1]);
			var __date = new Date(date.valueOf() + 1000);
			var temp = __date.toTimeString().split(" ");
			var timeST = temp[0].split(":");
			if (timeST[1] >= 10) {
				Wo_ClearTimeout();
				Wo_stopRecording();
			}
			else {
				self.text(timeST[1] + ":" + timeST[2]);
				wo_timeout = setTimeout(Wo_ShowRecordingTime, 1000, recording_time)
			}

		}
		var audio_context, recorder, recording_time, wo_timeout, localstream, recording_node, chat_tab, comm_field;
		function Wo_startUserMedia(stream) {
			localstream = stream;
			var input = audio_context.createMediaStreamSource(stream);
			if (input) {
				recorder = new Recorder(input, { bufferLen: 16384 });
			}
			else {
				console.log('Could not initialize media stream');
			}
		}

		function Wo_startRecording() {
			recorder && recorder.record();
			recording_time.removeClass('hidden');
			recorder && recorder.exportWAV(function (blob) { });
			recorder && setTimeout(Wo_ShowRecordingTime, 1000, recording_time);
			//console.log('recording started');
		}

		function Wo_stopRecording() {
			recorder && recorder.stop();
			wo_timeout && clearTimeout(wo_timeout);
			//recorder     && console.log('recording sotopped');
		}

		function Wo_StopLocalStream() {
			localstream && localstream.getTracks().forEach(function (track) { track.stop() });
			localstream = false;
			recording_node = false;
			delete (recorder);
		}

		function Wo_clearPRecording() {
			recorder && recorder.clear();
			recording_time && recording_time.text('00:00');
			recorder && clearTimeout(wo_timeout);
			recording_time && recording_time.addClass('hidden');
			$("#recordPostAudio").html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>').attr('data-record', '0');
		}

		function Wo_clearMRecording() {
			recorder && recorder.clear();
			recording_time && recording_time.text('00:00');
			recorder && clearTimeout(wo_timeout);
			recording_time && recording_time.addClass('hidden');
			$("#messages-record").html('<svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 24 24"><path fill="#ff3a55" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"></path></svg>').attr('data-record', '0');
		}

		function Wo_GetPRecordLink() {
			var publisher_button = $('#publisher-button');
			publisher_button.attr('disabled', true);
			publisher_button.css('color', '#333');
			$('#publisher-box-focus .pub-footer-bottom').find('.ball-pulse').fadeIn(100);
			if (recorder && recording_node == "post") {
				recorder.exportWAV(function (blob) {
					if (blob instanceof Blob && blob.size > 50) {
						var fileName = (new Date).toISOString().replace(/:|\./g, '-');
						var file = new File([blob], 'wo-' + fileName + '.wav', { type: 'audio/wav' });
						var dataForm = new FormData();
						dataForm.append('audio-filename', file.name);
						dataForm.append('audio-blob', file);
						Wo_RegisterPost(dataForm);
					}
					else { $('form.post').submit() }
				});
			}
			else { $('form.post').submit() }
		}

		function Wo_GetMRecordLink() {
			if (recorder && recording_node == "msg") {
				recorder.exportWAV(function (blob) {
					if (blob instanceof Blob && blob.size > 50) {
						var fileName = (new Date).toISOString().replace(/:|\./g, '-');
						var file = new File([blob], 'AU-' + fileName + '.wav', { type: 'audio/wav' });
						var dataForm = new FormData();
						dataForm.append('audio-filename', file.name);
						dataForm.append('audio-blob', file);
						Wo_RegisterMessage(dataForm);
					}
					else { $('form.sendMessages').submit() }

				});
			}
			else { $('form.sendMessages').submit() }
		}

		function Wo_RegisterTabMessage(id) {

			if (!id) {
				return false;
			}

			if (recorder && recording_node == "chat" && id == chat_tab) {
				recorder.exportWAV(function (blob) {
					if (blob instanceof Blob && blob.size > 50) {
						var fileName = (new Date).toISOString().replace(/:|\./g, '-');
						var file = new File([blob], 'AU-' + fileName + '.wav', { type: 'audio/wav' });
						var dataForm = new FormData();
						dataForm.append('audio-filename', file.name);
						dataForm.append('audio-blob', file);
						Wo_RegisterTabMessageRecord(dataForm, id);
					}
					else { $('form.chat-sending-form-' + id).submit(); }

				});
			}
			else { $('form.chat-sending-form-' + id).submit(); }
		}

		function Wo_RegisterTabMessageRecord(dataForm, id) {
			if (dataForm && id) {
				$.ajax({
					url: Wo_Ajax_Requests_File() + "?f=chat&s=register_message_record",
					type: 'POST',
					cache: false,
					dataType: 'json',
					data: dataForm,
					processData: false,
					contentType: false,
				}).done(function (data) {
					if (data.status == 200) {
						Wo_stopRecording();
						Wo_CleanRecordNodes();
						Wo_StopLocalStream();
						$('form.chat-sending-form-' + id).find('input.message-record').val(data.url);
						$('form.chat-sending-form-' + id).find('input.media-name').val(data.name);
						$('form.chat-sending-form-' + id).submit();
					}
				});
			}
		}

		function Wo_RegisterPost(dataForm) {
			if (dataForm) {
				$.ajax({
					url: Wo_Ajax_Requests_File() + "?f=posts&s=register_post_record",
					type: 'POST',
					cache: false,
					dataType: 'json',
					data: dataForm,
					processData: false,
					contentType: false,
				}).done(function (data) {
					if (data.status == 200) {
						Wo_stopRecording();
						Wo_clearPRecording();
						Wo_StopLocalStream();
						$("#postRecord").val(data.url)
						$('form.post').submit()
					}
				});
			}
		}

		function Wo_RegisterMessage(dataForm) {
			if (dataForm) {
				$.ajax({
					url: Wo_Ajax_Requests_File() + "?f=messages&s=upload_record",
					type: 'POST',
					cache: false,
					dataType: 'json',
					data: dataForm,
					processData: false,
					contentType: false,
				}).done(function (data) {
					if (data.status == 200) {
						Wo_stopRecording();
						Wo_clearMRecording();
						Wo_StopLocalStream();
						$("#message-record-file").val(data.url);
						$("#message-record-name").val(data.name);
						$('form.sendMessages').submit();
					}
				});
			}
		}

		function Wo_RegisterComment(text, post_id, user_id, event, page_id, type) {
			if (event.keyCode == 13 && event.shiftKey == 0 && recording_node == "comm") {
				Wo_stopRecording();
				if (recorder) {
					recorder.exportWAV(function (blob) {
						var comment_src_image = $('#post-' + post_id).find('#comment_src_image');
						var comment_image = '';
						if (comment_src_image.length > 0) {
							comment_image = comment_src_image.val();
						}
						var dataForm = new FormData();
						dataForm.append('post_id', post_id);
						dataForm.append('text', text);
						dataForm.append('user_id', user_id);
						dataForm.append('page_id', page_id);
						dataForm.append('comment_image', comment_image);
						if (blob.size > 50) {
							var fileName = (new Date).toISOString().replace(/:|\./g, '-');
							var file = new File([blob], 'wo-' + fileName + '.wav', { type: 'audio/wav' });
							dataForm.append('audio-filename', file.name);
							dataForm.append('audio-blob', file);
						}
						Wo_InsertComment(dataForm, post_id);
					});
				}

				else {
					var comment_src_image = $('#post-' + post_id).find('#comment_src_image');
					var comment_image = '';
					if (comment_src_image.length > 0) {
						comment_image = comment_src_image.val();
					}
					var dataForm = new FormData();
					dataForm.append('post_id', post_id);
					dataForm.append('text', text);
					dataForm.append('user_id', user_id);
					dataForm.append('page_id', page_id);
					dataForm.append('comment_image', comment_image);
					$('#charsLeft_' + post_id).text($('#charsLeft_' + post_id).attr('data_num'));
					Wo_InsertComment(dataForm, post_id);
				}
			}
		}

		function Wo_InsertComment(dataForm, post_id) {
			if (!dataForm) { return false; }
			post_wrapper = $('[id=post-' + post_id + ']');
			comment_textarea = post_wrapper.find('.post-comments');
			comment_btn = comment_textarea.find('.emo-comment');
			textarea_wrapper = comment_textarea.find('.textarea');
			comment_list = post_wrapper.find('.comments-list');
			//event.preventDefault();
			textarea_wrapper.val('');
			post_wrapper.find('.loading_cont .loading').removeClass('hidden');
			$.ajax({
				url: Wo_Ajax_Requests_File() + '?f=posts&s=register_comment&hash=' + $('.main_session').val(),
				type: 'POST',
				cache: false,
				dataType: 'json',
				data: dataForm,
				processData: false,
				contentType: false,
			}).done(function (data) {
				if (data.status == 200) {
					Wo_CleanRecordNodes();
					post_wrapper.find('.post-footer .comment-container:last-child').after(data.html);
					post_wrapper.find('.comments-list-lightbox .comment-container:first').before(data.html);
					post_wrapper.find('[id=comments]').html(data.comments_num);
					post_wrapper.find('textarea').attr("style", "height:36px;");
					post_wrapper.find('.lightbox-no-comments').remove();
					Wo_StopLocalStream();
				}
				$('#post-' + post_id).find('.comment-image-con').empty().addClass('hidden');
				$('#post-' + post_id).find('#comment_src_image').val('');
				post_wrapper.find('.loading_cont .loading').addClass('hidden');
				if (data.can_send == 1) {
					Wo_SendMessages();
				}
			});
		}
	</script>
	<script>
		(function (f) { if (typeof exports === "object" && typeof module !== "undefined") { module.exports = f() } else if (typeof define === "function" && define.amd) { define([], f) } else { var g; if (typeof window !== "undefined") { g = window } else if (typeof global !== "undefined") { g = global } else if (typeof self !== "undefined") { g = self } else { g = this } g.Recorder = f() } })(function () {
			var define, module, exports; return (function e(t, n, r) { function s(o, u) { if (!n[o]) { if (!t[o]) { var a = typeof require == "function" && require; if (!u && a) return a(o, !0); if (i) return i(o, !0); var f = new Error("Cannot find module '" + o + "'"); throw f.code = "MODULE_NOT_FOUND", f } var l = n[o] = { exports: {} }; t[o][0].call(l.exports, function (e) { var n = t[o][1][e]; return s(n ? n : e) }, l, l.exports, e, t, n, r) } return n[o].exports } var i = typeof require == "function" && require; for (var o = 0; o < r.length; o++)s(r[o]); return s })({
				1: [function (require, module, exports) {
					"use strict";

					module.exports = require("./recorder").Recorder;

				}, { "./recorder": 2 }], 2: [function (require, module, exports) {
					'use strict';

					var _createClass = (function () {
						function defineProperties(target, props) {
							for (var i = 0; i < props.length; i++) {
								var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor);
							}
						} return function (Constructor, protoProps, staticProps) {
							if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor;
						};
					})();

					Object.defineProperty(exports, "__esModule", {
						value: true
					});
					exports.Recorder = undefined;

					var _inlineWorker = require('inline-worker');

					var _inlineWorker2 = _interopRequireDefault(_inlineWorker);

					function _interopRequireDefault(obj) {
						return obj && obj.__esModule ? obj : { default: obj };
					}

					function _classCallCheck(instance, Constructor) {
						if (!(instance instanceof Constructor)) {
							throw new TypeError("Cannot call a class as a function");
						}
					}

					var Recorder = exports.Recorder = (function () {
						function Recorder(source, cfg) {
							var _this = this;

							_classCallCheck(this, Recorder);

							this.config = {
								bufferLen: 4096,
								numChannels: 2,
								mimeType: 'audio/wav'
							};
							this.recording = false;
							this.callbacks = {
								getBuffer: [],
								exportWAV: []
							};

							Object.assign(this.config, cfg);
							this.context = source.context;
							this.node = (this.context.createScriptProcessor || this.context.createJavaScriptNode).call(this.context, this.config.bufferLen, this.config.numChannels, this.config.numChannels);

							this.node.onaudioprocess = function (e) {
								if (!_this.recording) return;

								var buffer = [];
								for (var channel = 0; channel < _this.config.numChannels; channel++) {
									buffer.push(e.inputBuffer.getChannelData(channel));
								}
								_this.worker.postMessage({
									command: 'record',
									buffer: buffer
								});
							};

							source.connect(this.node);
							this.node.connect(this.context.destination); //this should not be necessary

							var self = {};
							this.worker = new _inlineWorker2.default(function () {
								var recLength = 0,
									recBuffers = [],
									sampleRate = undefined,
									numChannels = undefined;

								self.onmessage = function (e) {
									switch (e.data.command) {
										case 'init':
											init(e.data.config);
											break;
										case 'record':
											record(e.data.buffer);
											break;
										case 'exportWAV':
											exportWAV(e.data.type);
											break;
										case 'getBuffer':
											getBuffer();
											break;
										case 'clear':
											clear();
											break;
									}
								};

								function init(config) {
									sampleRate = config.sampleRate;
									numChannels = config.numChannels;
									initBuffers();
								}

								function record(inputBuffer) {
									for (var channel = 0; channel < numChannels; channel++) {
										recBuffers[channel].push(inputBuffer[channel]);
									}
									recLength += inputBuffer[0].length;
								}

								function exportWAV(type) {
									var buffers = [];
									for (var channel = 0; channel < numChannels; channel++) {
										buffers.push(mergeBuffers(recBuffers[channel], recLength));
									}
									var interleaved = undefined;
									if (numChannels === 2) {
										interleaved = interleave(buffers[0], buffers[1]);
									} else {
										interleaved = buffers[0];
									}
									var dataview = encodeWAV(interleaved);
									var audioBlob = new Blob([dataview], { type: type });

									self.postMessage({ command: 'exportWAV', data: audioBlob });
								}

								function getBuffer() {
									var buffers = [];
									for (var channel = 0; channel < numChannels; channel++) {
										buffers.push(mergeBuffers(recBuffers[channel], recLength));
									}
									self.postMessage({ command: 'getBuffer', data: buffers });
								}

								function clear() {
									recLength = 0;
									recBuffers = [];
									initBuffers();
								}

								function initBuffers() {
									for (var channel = 0; channel < numChannels; channel++) {
										recBuffers[channel] = [];
									}
								}

								function mergeBuffers(recBuffers, recLength) {
									var result = new Float32Array(recLength);
									var offset = 0;
									for (var i = 0; i < recBuffers.length; i++) {
										result.set(recBuffers[i], offset);
										offset += recBuffers[i].length;
									}
									return result;
								}

								function interleave(inputL, inputR) {
									var length = inputL.length + inputR.length;
									var result = new Float32Array(length);

									var index = 0,
										inputIndex = 0;

									while (index < length) {
										result[index++] = inputL[inputIndex];
										result[index++] = inputR[inputIndex];
										inputIndex++;
									}
									return result;
								}

								function floatTo16BitPCM(output, offset, input) {
									for (var i = 0; i < input.length; i++ , offset += 2) {
										var s = Math.max(-1, Math.min(1, input[i]));
										output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
									}
								}

								function writeString(view, offset, string) {
									for (var i = 0; i < string.length; i++) {
										view.setUint8(offset + i, string.charCodeAt(i));
									}
								}

								function encodeWAV(samples) {
									var buffer = new ArrayBuffer(44 + samples.length * 2);
									var view = new DataView(buffer);

									/* RIFF identifier */
									writeString(view, 0, 'RIFF');
									/* RIFF chunk length */
									view.setUint32(4, 36 + samples.length * 2, true);
									/* RIFF type */
									writeString(view, 8, 'WAVE');
									/* format chunk identifier */
									writeString(view, 12, 'fmt ');
									/* format chunk length */
									view.setUint32(16, 16, true);
									/* sample format (raw) */
									view.setUint16(20, 1, true);
									/* channel count */
									view.setUint16(22, numChannels, true);
									/* sample rate */
									view.setUint32(24, sampleRate, true);
									/* byte rate (sample rate * block align) */
									view.setUint32(28, sampleRate * 4, true);
									/* block align (channel count * bytes per sample) */
									view.setUint16(32, numChannels * 2, true);
									/* bits per sample */
									view.setUint16(34, 16, true);
									/* data chunk identifier */
									writeString(view, 36, 'data');
									/* data chunk length */
									view.setUint32(40, samples.length * 2, true);

									floatTo16BitPCM(view, 44, samples);

									return view;
								}
							}, self);

							this.worker.postMessage({
								command: 'init',
								config: {
									sampleRate: this.context.sampleRate,
									numChannels: this.config.numChannels
								}
							});

							this.worker.onmessage = function (e) {
								var cb = _this.callbacks[e.data.command].pop();
								if (typeof cb == 'function') {
									cb(e.data.data);
								}
							};
						}

						_createClass(Recorder, [{
							key: 'record',
							value: function record() {
								this.recording = true;
							}
						}, {
							key: 'stop',
							value: function stop() {
								this.recording = false;
							}
						}, {
							key: 'clear',
							value: function clear() {
								this.worker.postMessage({ command: 'clear' });
							}
						}, {
							key: 'getBuffer',
							value: function getBuffer(cb) {
								cb = cb || this.config.callback;
								if (!cb) throw new Error('Callback not set');

								this.callbacks.getBuffer.push(cb);

								this.worker.postMessage({ command: 'getBuffer' });
							}
						}, {
							key: 'exportWAV',
							value: function exportWAV(cb, mimeType) {
								mimeType = mimeType || this.config.mimeType;
								cb = cb || this.config.callback;
								if (!cb) throw new Error('Callback not set');

								this.callbacks.exportWAV.push(cb);

								this.worker.postMessage({
									command: 'exportWAV',
									type: mimeType
								});
							}
						}], [{
							key: 'forceDownload',
							value: function forceDownload(blob, filename) {
								var url = (window.URL || window.webkitURL).createObjectURL(blob);
								var link = window.document.createElement('a');
								link.href = url;
								link.download = filename || 'output.wav';
								var click = document.createEvent("Event");
								click.initEvent("click", true, true);
								link.dispatchEvent(click);
							}
						}]);

						return Recorder;
					})();

					exports.default = Recorder;

				}, { "inline-worker": 3 }], 3: [function (require, module, exports) {
					"use strict";

					module.exports = require("./inline-worker");
				}, { "./inline-worker": 4 }], 4: [function (require, module, exports) {
					(function (global) {
						"use strict";

						var _createClass = (function () { function defineProperties(target, props) { for (var key in props) { var prop = props[key]; prop.configurable = true; if (prop.value) prop.writable = true; } Object.defineProperties(target, props); } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

						var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };

						var WORKER_ENABLED = !!(global === global.window && global.URL && global.Blob && global.Worker);

						var InlineWorker = (function () {
							function InlineWorker(func, self) {
								var _this = this;

								_classCallCheck(this, InlineWorker);

								if (WORKER_ENABLED) {
									var functionBody = func.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1];
									var url = global.URL.createObjectURL(new global.Blob([functionBody], { type: "text/javascript" }));

									return new global.Worker(url);
								}

								this.self = self;
								this.self.postMessage = function (data) {
									setTimeout(function () {
										_this.onmessage({ data: data });
									}, 0);
								};

								setTimeout(function () {
									func.call(self);
								}, 0);
							}

							_createClass(InlineWorker, {
								postMessage: {
									value: function postMessage(data) {
										var _this = this;

										setTimeout(function () {
											_this.self.onmessage({ data: data });
										}, 0);
									}
								}
							});

							return InlineWorker;
						})();

						module.exports = InlineWorker;
					}).call(this, typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
				}, {}]
			}, {}, [1])(1)
		});
	</script>
	<script>
		$(document).keydown(function (e) {
			if (e.keyCode == 27) {
				CloseLightbox();
			}
		});
		var angle = 0;
		function rotate(id) {
			angle += 90;
			$('#wo_zoom_' + id).css({ 'transform': 'rotate(-' + angle + 'deg)' });
		}
	</script>
</body>
</html>
